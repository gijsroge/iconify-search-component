{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "iconify-search-dialog",
  "title": "Iconify Search Dialog",
  "description": "Button that opens a dialog to search and browse icons grouped by collection.",
  "dependencies": [
    "@tanstack/react-query",
    "@tanstack/react-pacer"
  ],
  "registryDependencies": [
    "dialog",
    "button",
    "input"
  ],
  "files": [
    {
      "path": "registry/new-york/blocks/iconify-search-dialog/iconify-search-dialog.tsx",
      "content": "\"use client\";\n\nimport * as React from \"react\";\nimport { LoaderIcon, SearchIcon } from \"lucide-react\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { IconifySearchPrimitive } from \"@/components/iconify-search-primitive\";\nimport { cn } from \"@/lib/utils\";\n\nexport interface IconifySearchDialogProps {\n  /** Allow selecting multiple icons */\n  multiple?: boolean;\n}\n\nexport function IconifySearchDialog({\n  multiple = false,\n}: IconifySearchDialogProps): React.ReactElement | null {\n  const [open, setOpen] = React.useState(false);\n\n  return (\n    <IconifySearchPrimitive debounceMs={300} multiple={multiple}>\n      {(state) => (\n        <Dialog open={open} onOpenChange={setOpen}>\n          <DialogTrigger asChild>\n            <Button variant=\"outline\" size=\"sm\">\n              {state.selectedIcons.length > 0 ? (\n                <span className=\"flex items-center gap-2\">\n                  {state.selectedIcons.slice(0, 3).map((iconId) => (\n                    <img\n                      key={iconId}\n                      src={state.getIconUrl(iconId, 18)}\n                      alt=\"\"\n                      className=\"size-4\"\n                      width={18}\n                      height={18}\n                    />\n                  ))}\n                  {state.selectedIcons.length > 3 && (\n                    <span className=\"text-muted-foreground text-xs\">\n                      +{state.selectedIcons.length - 3}\n                    </span>\n                  )}\n                  {!state.multiple && state.selectedIcons[0] && (\n                    <span>\n                      {state.selectedIcons[0].split(\":\")[1] ??\n                        state.selectedIcons[0]}\n                    </span>\n                  )}\n                </span>\n              ) : (\n                <span className=\"flex items-center gap-2\">\n                  <SearchIcon className=\"size-4\" />\n                  {state.multiple ? \"Pick icons\" : \"Pick icon\"}\n                </span>\n              )}\n            </Button>\n          </DialogTrigger>\n          <DialogContent className=\"flex h-[520px] flex-col gap-4 sm:max-w-xl\">\n            <DialogHeader>\n              <DialogTitle>Search icons</DialogTitle>\n            </DialogHeader>\n            <div className=\"flex min-h-0 flex-1 flex-col gap-4\">\n              <div className=\"relative shrink-0\">\n                <Input\n                  placeholder=\"Search icons...\"\n                  value={state.query}\n                  onChange={(e) => state.setQuery(e.target.value)}\n                  className=\"pr-9\"\n                />\n                {state.isPending && (\n                  <LoaderIcon\n                    className=\"text-muted-foreground absolute right-3 top-1/2 size-4 -translate-y-1/2 animate-spin\"\n                    aria-hidden\n                  />\n                )}\n              </div>\n              <div className=\"scroll-fade-y min-h-0 flex-1\">\n                {!state.debouncedQuery.trim() ? (\n                  <p className=\"text-muted-foreground py-8 text-center text-sm\">\n                    Type to search icons from Iconify\n                  </p>\n                ) : state.isPending && !state.data ? (\n                  <p className=\"text-muted-foreground py-8 text-center text-sm\">\n                    Searching...\n                  </p>\n                ) : state.groups.length === 0 ? (\n                  <p className=\"text-muted-foreground py-8 text-center text-sm\">\n                    No icons found. Try a different search.\n                  </p>\n                ) : (\n                  <div className=\"flex flex-col gap-6 pb-4\">\n                    {state.groups.map(({ prefix, name, icons }) => (\n                      <div key={prefix} className=\"flex flex-col gap-2\">\n                        <h3 className=\"text-muted-foreground sticky top-0 bg-background/95 px-2 py-1 text-xs font-medium backdrop-blur sm:px-0\">\n                          {name}\n                        </h3>\n                        <div className=\"grid grid-cols-6 gap-1 sm:grid-cols-8\">\n                          {icons.map((iconId) => {\n                            const isSelected =\n                              state.selectedIcons.includes(iconId);\n                            return (\n                              <button\n                                key={iconId}\n                                type=\"button\"\n                                onClick={() => {\n                                  state.selectIcon(iconId);\n                                  if (!state.multiple) setOpen(false);\n                                }}\n                                className={cn(\n                                  \"flex size-10 shrink-0 items-center justify-center rounded-md transition-colors hover:bg-accent\",\n                                  isSelected && \"bg-accent\"\n                                )}\n                              >\n                                <img\n                                  src={state.getIconUrl(iconId, 24)}\n                                  alt={iconId.split(\":\")[1] ?? iconId}\n                                  className=\"size-6\"\n                                  width={24}\n                                  height={24}\n                                />\n                              </button>\n                            );\n                          })}\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                )}\n              </div>\n            </div>\n            {state.multiple && state.selectedIcons.length > 0 && (\n              <div className=\"flex items-center justify-between gap-4 pt-2 border-t -mx-6 px-6\">\n                <div className=\"relative min-w-0 flex-1 overflow-hidden\">\n                  <div\n                    className=\"flex gap-1 overflow-x-auto pb-1 scrollbar-width:none [&::-webkit-scrollbar]:hidden\"\n                    style={{\n                      maskImage:\n                        \"linear-gradient(to right, black 70%, transparent 100%)\",\n                      WebkitMaskImage:\n                        \"linear-gradient(to right, black 70%, transparent 100%)\",\n                    }}\n                  >\n                    {state.selectedIcons.map((iconId) => (\n                      <img\n                        key={iconId}\n                        src={state.getIconUrl(iconId, 24)}\n                        alt={iconId.split(\":\")[1] ?? iconId}\n                        className=\"size-6 shrink-0 rounded\"\n                        width={16}\n                        height={16}\n                      />\n                    ))}\n                  </div>\n                </div>\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  className=\"shrink-0 text-muted-foreground hover:text-foreground\"\n                  onClick={() => state.setSelectedIcons([])}\n                >\n                  Clear all\n                </Button>\n              </div>\n            )}\n          </DialogContent>\n        </Dialog>\n      )}\n    </IconifySearchPrimitive>\n  );\n}\n",
      "type": "registry:component"
    },
    {
      "path": "components/iconify-search-primitive.tsx",
      "content": "\"use client\";\n\nimport * as React from \"react\";\nimport { useDebouncedValue } from \"@tanstack/react-pacer\";\nimport { useIconifySearchAll } from \"@/hooks/use-iconify-search\";\nimport { getIconUrl } from \"@/lib/iconify\";\nimport type { IconifySearchResponse } from \"@/lib/iconify\";\n\nconst DEFAULT_DEBOUNCE_MS = 300;\n\nexport interface IconifySearchState {\n  /** Whether multiple selection is allowed */\n  multiple: boolean;\n  /** Current raw query string */\n  query: string;\n  /** Update the search query */\n  setQuery: (value: string) => void;\n  /** Debounced query used for API calls */\n  debouncedQuery: string;\n  /** Whether the debouncer is still pending */\n  isDebouncing: boolean;\n  /** Raw search response from Iconify API */\n  data: IconifySearchResponse | undefined;\n  /** Whether the initial fetch is loading */\n  isLoading: boolean;\n  /** Whether a fetch is in progress (including refetch) */\n  isFetching: boolean;\n  /** Combined: debouncing or fetching */\n  isPending: boolean;\n  /** Helper to get Iconify CDN URL for an icon */\n  getIconUrl: (iconId: string, size?: number) => string;\n  /** Selected icon IDs (always an array; max 1 when multiple=false) */\n  selectedIcons: string[];\n  /** Update selected icons (enforces max 1 when multiple=false) */\n  setSelectedIcons: (iconIds: string[]) => void;\n  /** Select/replace icon when multiple=false; toggle when multiple=true */\n  selectIcon: (iconId: string) => void;\n  /** Icons grouped by collection prefix for display */\n  groups: Array<{ prefix: string; name: string; icons: string[] }>;\n}\n\nexport interface IconifySearchPrimitiveProps {\n  /** Allow selecting multiple icons. When false, max 1 and selectIcon replaces. */\n  multiple?: boolean;\n  /** Debounce delay in ms before triggering search */\n  debounceMs?: number;\n  /** Render function receiving search state */\n  children: (state: IconifySearchState) => React.ReactNode;\n}\n\n/**\n * Renderless component that interfaces with the Iconify API for icon search.\n * Always uses selectedIcons internally; when multiple=false, enforces max 1.\n * Use this to build custom UI (dialogs, etc.) without duplicating logic.\n */\nexport function IconifySearchPrimitive({\n  multiple = false,\n  debounceMs = DEFAULT_DEBOUNCE_MS,\n  children,\n}: IconifySearchPrimitiveProps): React.ReactElement {\n  const [query, setQuery] = React.useState(\"\");\n  const [selectedIcons, setSelectedIconsState] = React.useState<string[]>([]);\n\n  const setSelectedIcons = React.useCallback(\n    (ids: string[]) => {\n      setSelectedIconsState(multiple ? ids : ids.slice(0, 1));\n    },\n    [multiple]\n  );\n\n  const selectIcon = React.useCallback(\n    (iconId: string) => {\n      if (multiple) {\n        setSelectedIconsState((prev) =>\n          prev.includes(iconId)\n            ? prev.filter((id) => id !== iconId)\n            : [...prev, iconId]\n        );\n      } else {\n        setSelectedIconsState([iconId]);\n      }\n    },\n    [multiple]\n  );\n\n  const [debouncedQuery, debouncer] = useDebouncedValue(\n    query,\n    { wait: debounceMs },\n    (s) => ({ isPending: s.isPending })\n  );\n  const isDebouncing = debouncer.state.isPending ?? false;\n  const { data, isLoading, isFetching } = useIconifySearchAll(debouncedQuery);\n  const isPending = isDebouncing || isLoading || isFetching;\n\n  const groups = React.useMemo(() => {\n    const icons = data?.icons ?? [];\n    const deduped = [...new Set(icons)];\n    const allCollections: Record<string, { name: string }> = {};\n    if (data?.collections) {\n      Object.entries(data.collections).forEach(([prefix, info]) => {\n        allCollections[prefix] = { name: info.name ?? prefix };\n      });\n    }\n    for (const iconId of selectedIcons) {\n      if (!deduped.includes(iconId)) {\n        deduped.unshift(iconId);\n        const [prefix] = iconId.split(\":\");\n        if (prefix && !allCollections[prefix]) {\n          allCollections[prefix] = { name: prefix };\n        }\n      }\n    }\n    const byPrefix = new Map<string, string[]>();\n    for (const iconId of deduped) {\n      const prefix = iconId.split(\":\")[0] ?? \"other\";\n      if (!byPrefix.has(prefix)) byPrefix.set(prefix, []);\n      byPrefix.get(prefix)!.push(iconId);\n    }\n    return Array.from(byPrefix.entries()).map(([prefix, icons]) => ({\n      prefix,\n      name: allCollections[prefix]?.name ?? prefix,\n      icons,\n    }));\n  }, [data, selectedIcons]);\n\n  const state: IconifySearchState = {\n    multiple,\n    query,\n    setQuery,\n    debouncedQuery,\n    isDebouncing,\n    data,\n    isLoading,\n    isFetching,\n    isPending,\n    getIconUrl,\n    selectedIcons,\n    setSelectedIcons,\n    selectIcon,\n    groups,\n  };\n\n  return <>{children(state)}</>;\n}\n",
      "type": "registry:component"
    },
    {
      "path": "lib/iconify.ts",
      "content": "import type { IconifyInfo } from \"@iconify/types\";\n\nconst ICONIFY_API = \"https://api.iconify.design\";\n\nexport interface IconifySearchResponse {\n  icons: string[];\n  total: number;\n  limit: number;\n  start: number;\n  collections: Record<string, IconifyInfo>;\n  request: Record<string, string>;\n}\n\nexport async function searchIcons(\n  query: string,\n  options?: { limit?: number; start?: number }\n): Promise<IconifySearchResponse> {\n  const params = new URLSearchParams({\n    query: query.trim() || \" \",\n    limit: String(options?.limit ?? 64),\n    ...(options?.start != null && { start: String(options.start) }),\n  });\n\n  const response = await fetch(`${ICONIFY_API}/search?${params}`);\n\n  if (!response.ok) {\n    throw new Error(`Iconify API error: ${response.status}`);\n  }\n\n  return response.json();\n}\n\nexport function getIconUrl(iconId: string, size = 24): string {\n  const [prefix, name] = iconId.split(\":\");\n  if (!prefix || !name) return \"\";\n  return `https://api.iconify.design/${prefix}/${name}.svg?height=${size}`;\n}\n",
      "type": "registry:lib"
    },
    {
      "path": "hooks/use-iconify-search.ts",
      "content": "\"use client\"\n\nimport { useQuery } from \"@tanstack/react-query\"\nimport {\n  searchIcons,\n  type IconifySearchResponse,\n} from \"@/lib/iconify\"\n\nconst MAX_LIMIT = 999\n\nexport function useIconifySearchAll(query: string) {\n  return useQuery<IconifySearchResponse>({\n    queryKey: [\"iconify-search-all\", query],\n    queryFn: () => searchIcons(query, { limit: MAX_LIMIT }),\n    enabled: query.trim().length > 0,\n    staleTime: 1000 * 60 * 5,\n  })\n}\n",
      "type": "registry:hook"
    }
  ],
  "css": {
    "@property --top-fade": {
      "syntax": "<length>",
      "inherits": "false",
      "initial-value": "0"
    },
    "@property --bottom-fade": {
      "syntax": "<length>",
      "inherits": "false",
      "initial-value": "0"
    },
    "@keyframes scrollfade-y": {
      "0%": {
        "--top-fade": "0",
        "--bottom-fade": "3rem"
      },
      "10%": {
        "--top-fade": "3rem"
      },
      "90%": {
        "--bottom-fade": "3rem"
      },
      "100%": {
        "--top-fade": "3rem",
        "--bottom-fade": "0"
      }
    },
    ".scroll-fade-y": {
      "overflow-y": "auto",
      "scroll-timeline": "--scrollfade block",
      "animation": "scrollfade-y linear",
      "animation-timeline": "--scrollfade",
      "animation-fill-mode": "both",
      "mask": "linear-gradient(to bottom, transparent 0, black var(--top-fade), black calc(100% - var(--bottom-fade)), transparent 100%)",
      "-webkit-mask": "linear-gradient(to bottom, transparent 0, black var(--top-fade), black calc(100% - var(--bottom-fade)), transparent 100%)"
    }
  },
  "type": "registry:component"
}