{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "iconify-search",
  "title": "Iconify Search",
  "description": "Button that opens a dialog to search and browse icons grouped by collection.",
  "dependencies": [
    "@gijsroge/iconify-search",
    "@tanstack/react-query",
    "@tanstack/react-pacer",
    "@tanstack/react-virtual"
  ],
  "registryDependencies": [
    "dialog",
    "button",
    "input"
  ],
  "files": [
    {
      "path": "registry/new-york/blocks/iconify-search/iconify-search.tsx",
      "content": "\"use client\";\n\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { cn } from \"@/lib/utils\";\nimport type { IconifySearchState } from \"@gijsroge/iconify-search\";\nimport { IconifySearchPrimitive } from \"@gijsroge/iconify-search\";\nimport { useVirtualizer } from \"@tanstack/react-virtual\";\nimport { LoaderIcon, SearchIcon, X } from \"lucide-react\";\nimport * as React from \"react\";\n\nconst ICONS_PER_ROW = 8;\nconst ROW_HEIGHT = 40;\nconst HEADER_ROW_HEIGHT = 28;\n\ntype IconifySearchContextValue = {\n  disabled: boolean;\n};\n\nconst IconifySearchContext = React.createContext<IconifySearchContextValue | null>(null);\n\nfunction useIconifySearchContext(): IconifySearchContextValue {\n  const ctx = React.useContext(IconifySearchContext);\n  if (!ctx) throw new Error(\"useIconifySearchContext must be used within IconifySearch\");\n  return ctx;\n}\n\ntype VirtualRow =\n  | { type: \"header\"; name: string; key: string }\n  | { type: \"icons\"; iconIds: string[]; key: string };\n\nfunction flattenGroupsToRows(\n  groups: Array<{ prefix: string; name: string; icons: string[] }>\n): VirtualRow[] {\n  const rows: VirtualRow[] = [];\n  for (const { prefix, name, icons } of groups) {\n    rows.push({ type: \"header\", name, key: `h-${prefix}` });\n    for (let i = 0; i < icons.length; i += ICONS_PER_ROW) {\n      rows.push({\n        type: \"icons\",\n        iconIds: icons.slice(i, i + ICONS_PER_ROW),\n        key: `${prefix}-${i}`,\n      });\n    }\n  }\n  return rows;\n}\n\nconst IconCell = React.memo(function IconCell({\n  iconId,\n  isSelected,\n  selectIcon,\n  onClose,\n  multiple,\n  getIconUrl,\n}: {\n  iconId: string;\n  isSelected: boolean;\n  selectIcon: (iconId: string) => void;\n  onClose: () => void;\n  multiple: boolean;\n  getIconUrl: (iconId: string, size?: number) => string;\n}) {\n  const { disabled } = useIconifySearchContext();\n  const onSelect = React.useCallback(() => {\n    if (disabled) return;\n    selectIcon(iconId);\n    if (!multiple) onClose();\n  }, [selectIcon, iconId, multiple, onClose, disabled]);\n\n  return (\n    <button\n      type=\"button\"\n      disabled={disabled}\n      onClick={onSelect}\n      className={cn(\n        \"flex size-10 shrink-0 items-center justify-center rounded-md transition-colors hover:bg-accent\",\n        isSelected && \"bg-accent\"\n      )}\n    >\n      <img\n        src={getIconUrl(iconId, 24)}\n        alt={iconId.split(\":\")[1] ?? iconId}\n        className=\"size-6\"\n        width={24}\n        height={24}\n      />\n    </button>\n  );\n});\n\nfunction VirtualizedIconList({\n  state,\n  setOpen,\n}: {\n  state: IconifySearchState;\n  setOpen: (open: boolean) => void;\n}) {\n  const parentRef = React.useRef<HTMLDivElement>(null);\n  const onClose = React.useCallback(() => setOpen(false), [setOpen]);\n  const rows = React.useMemo(\n    () => flattenGroupsToRows(state.groups),\n    [state.groups]\n  );\n\n  const virtualizer = useVirtualizer({\n    count: rows.length,\n    getScrollElement: () => parentRef.current,\n    estimateSize: (index) =>\n      rows[index].type === \"header\" ? HEADER_ROW_HEIGHT : ROW_HEIGHT,\n    overscan: 4,\n  });\n\n  const selectedSet = React.useMemo(\n    () => new Set(state.selectedIcons),\n    [state.selectedIcons]\n  );\n\n  return (\n    <div\n      ref={parentRef}\n      className=\"scroll-fade-y min-h-0 flex-1 overflow-y-auto\"\n      style={{ contain: \"strict\" }}\n    >\n      <div\n        style={{\n          height: `${virtualizer.getTotalSize()}px`,\n          width: \"100%\",\n          position: \"relative\",\n        }}\n      >\n        {virtualizer.getVirtualItems().map((virtualRow) => {\n          const row = rows[virtualRow.index];\n          if (row.type === \"header\") {\n            return (\n              <div\n                key={row.key}\n                className=\"text-muted-foreground absolute left-0 top-0 flex w-full items-center px-2 text-xs font-medium backdrop-blur sm:px-0\"\n                style={{\n                  height: HEADER_ROW_HEIGHT,\n                  transform: `translateY(${virtualRow.start}px)`,\n                }}\n              >\n                {row.name}\n              </div>\n            );\n          }\n          return (\n            <div\n              key={row.key}\n              className=\"absolute left-0 flex w-full gap-1 flex-wrap\"\n              style={{\n                height: ROW_HEIGHT,\n                transform: `translateY(${virtualRow.start}px)`,\n              }}\n            >\n              {row.iconIds.map((iconId) => (\n                <IconCell\n                  key={iconId}\n                  iconId={iconId}\n                  isSelected={selectedSet.has(iconId)}\n                  selectIcon={state.selectIcon}\n                  onClose={onClose}\n                  multiple={state.multiple}\n                  getIconUrl={state.getIconUrl}\n                />\n              ))}\n            </div>\n          );\n        })}\n      </div>\n    </div>\n  );\n}\n\nfunction IconifySearchUI({\n  state,\n  open,\n  setOpen,\n}: {\n  state: IconifySearchState;\n  open: boolean;\n  setOpen: (open: boolean) => void;\n}) {\n  const { disabled } = useIconifySearchContext();\n\n  return (\n    <Dialog open={open} onOpenChange={setOpen}>\n      <div className=\"relative\">\n        <DialogTrigger asChild>\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            disabled={disabled}\n            className={cn(state.selectedIcons.length > 0 && \"pr-8\")}\n          >\n            {state.selectedIcons.length > 0 ? (\n              <span className=\"flex items-center gap-2\">\n                {state.selectedIcons.slice(0, 3).map((iconId) => (\n                  <img\n                    key={iconId}\n                    src={state.getIconUrl(iconId, 18)}\n                    alt=\"\"\n                    className=\"size-4\"\n                    width={18}\n                    height={18}\n                  />\n                ))}\n                {state.selectedIcons.length > 3 && (\n                  <span className=\"text-muted-foreground text-xs\">\n                    +{state.selectedIcons.length - 3}\n                  </span>\n                )}\n                {!state.multiple && state.selectedIcons[0] && (\n                  <span>\n                    {state.selectedIcons[0].split(\":\")[1] ??\n                      state.selectedIcons[0]}\n                  </span>\n                )}\n              </span>\n            ) : (\n              <span className=\"flex items-center gap-2\">\n                <SearchIcon className=\"size-4\" />\n                {state.multiple ? \"Pick icons\" : \"Pick icon\"}\n              </span>\n            )}\n          </Button>\n        </DialogTrigger>\n        {state.selectedIcons.length > 0 && (\n          <Button\n            type=\"button\"\n            variant=\"ghost\"\n            size=\"icon\"\n            disabled={disabled}\n            className=\"group text-foreground/50 hover:text-foreground bg-transparent! absolute right-px top-px size-8 max-h-[calc(100%-2px)] shrink-0\"\n            onClick={() => state.setSelectedIcons([])}\n            aria-label=\"Clear selection\"\n          >\n            <X className=\"size-4 scale-80 group-hover:scale-90 transition-all\" />\n          </Button>\n        )}\n      </div>\n      <DialogContent className=\"flex h-[520px] flex-col gap-4 sm:max-w-xl\">\n        <DialogHeader>\n          <DialogTitle>Search icons</DialogTitle>\n        </DialogHeader>\n        <div className=\"flex min-h-0 flex-1 flex-col gap-4\">\n          <div className=\"relative shrink-0\">\n            <Input\n              placeholder=\"Search icons...\"\n              value={state.query}\n              onChange={(e) => state.setQuery(e.target.value)}\n              disabled={disabled}\n              className=\"pr-9\"\n            />\n            {state.isPending && (\n              <LoaderIcon\n                className=\"text-muted-foreground absolute right-3 top-1/2 size-4 -translate-y-1/2 animate-spin\"\n                aria-hidden\n              />\n            )}\n          </div>\n          {!state.debouncedQuery.trim() ? (\n            <div className=\"scroll-fade-y min-h-0 flex-1\">\n              <p className=\"text-muted-foreground py-8 text-center text-sm\">\n                Type to search icons from Iconify\n              </p>\n            </div>\n          ) : state.isPending && !state.data ? (\n            <div className=\"scroll-fade-y min-h-0 flex-1\">\n              <p className=\"text-muted-foreground py-8 text-center text-sm\">\n                Searching...\n              </p>\n            </div>\n          ) : state.groups.length === 0 ? (\n            <div className=\"scroll-fade-y min-h-0 flex-1\">\n              <p className=\"text-muted-foreground py-8 text-center text-sm\">\n                No icons found. Try a different search.\n              </p>\n            </div>\n          ) : (\n            <VirtualizedIconList state={state} setOpen={setOpen} />\n          )}\n        </div>\n        {state.multiple && state.selectedIcons.length > 0 && (\n          <div className=\"flex items-center justify-between gap-4 pt-2 border-t -mx-6 px-6\">\n            <div className=\"relative min-w-0 flex-1 overflow-hidden\">\n              <div\n                className=\"flex gap-1 overflow-x-auto pb-1 scrollbar-width:none [&::-webkit-scrollbar]:hidden\"\n                style={{\n                  maskImage:\n                    \"linear-gradient(to right, black 70%, transparent 100%)\",\n                  WebkitMaskImage:\n                    \"linear-gradient(to right, black 70%, transparent 100%)\",\n                }}\n              >\n                {state.selectedIcons.map((iconId) => (\n                  <img\n                    key={iconId}\n                    src={state.getIconUrl(iconId, 24)}\n                    alt={iconId.split(\":\")[1] ?? iconId}\n                    className=\"size-6 shrink-0 rounded\"\n                    width={16}\n                    height={16}\n                  />\n                ))}\n              </div>\n            </div>\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              disabled={disabled}\n              className=\"shrink-0 text-muted-foreground hover:text-foreground\"\n              onClick={() => state.setSelectedIcons([])}\n            >\n              Clear all\n            </Button>\n          </div>\n        )}\n      </DialogContent>\n    </Dialog>\n  );\n}\n\nexport interface IconifySearchProps {\n  /** Allow selecting multiple icons */\n  multiple?: boolean;\n  /** Disable the trigger, clear button, search input, and actions */\n  disabled?: boolean;\n  value?: string[];\n  defaultValue?: string[];\n  onValueChange?: (value: string[]) => void;\n  searchValue?: string;\n  defaultSearchValue?: string;\n  onSearchChange?: (value: string) => void;\n}\n\nexport function IconifySearch({\n  multiple,\n  disabled,\n  value,\n  defaultValue,\n  onValueChange,\n  searchValue,\n  defaultSearchValue,\n  onSearchChange,\n}: IconifySearchProps): React.ReactElement | null {\n  const [open, setOpen] = React.useState(false);\n\n  return (\n    <IconifySearchPrimitive\n      debounceMs={300}\n      multiple={multiple}\n      value={value}\n      defaultValue={defaultValue}\n      onValueChange={onValueChange}\n      searchValue={searchValue}\n      defaultSearchValue={defaultSearchValue}\n      onSearchChange={onSearchChange}\n    >\n      {(state) => (\n        <IconifySearchContext.Provider\n          value={{ disabled: disabled ?? false }}\n        >\n          <IconifySearchUI state={state} open={open} setOpen={setOpen} />\n        </IconifySearchContext.Provider>\n      )}\n    </IconifySearchPrimitive>\n  );\n}\n",
      "type": "registry:component"
    }
  ],
  "css": {
    "@property --top-fade": {
      "syntax": "<length>",
      "inherits": "false",
      "initial-value": "0"
    },
    "@property --bottom-fade": {
      "syntax": "<length>",
      "inherits": "false",
      "initial-value": "0"
    },
    "@keyframes scrollfade-y": {
      "0%": {
        "--top-fade": "0",
        "--bottom-fade": "3rem"
      },
      "10%": {
        "--top-fade": "3rem"
      },
      "90%": {
        "--bottom-fade": "3rem"
      },
      "100%": {
        "--top-fade": "3rem",
        "--bottom-fade": "0"
      }
    },
    ".scroll-fade-y": {
      "overflow-y": "auto",
      "scroll-timeline": "--scrollfade block",
      "animation": "scrollfade-y linear",
      "animation-timeline": "--scrollfade",
      "animation-fill-mode": "both",
      "mask": "linear-gradient(to bottom, transparent 0, black var(--top-fade), black calc(100% - var(--bottom-fade)), transparent 100%)",
      "-webkit-mask": "linear-gradient(to bottom, transparent 0, black var(--top-fade), black calc(100% - var(--bottom-fade)), transparent 100%)"
    }
  },
  "type": "registry:component"
}