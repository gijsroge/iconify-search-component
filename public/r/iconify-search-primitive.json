{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "iconify-search-primitive",
  "title": "Iconify Search Primitive",
  "description": "Renderless component for Iconify icon search. Build custom UIs with search state, grouping, and selection via render props.",
  "dependencies": [
    "@tanstack/react-query",
    "@tanstack/react-pacer"
  ],
  "files": [
    {
      "path": "components/iconify-search-primitive.tsx",
      "content": "\"use client\";\n\nimport * as React from \"react\";\nimport { useDebouncedValue } from \"@tanstack/react-pacer\";\nimport { useIconifySearchAll } from \"@/hooks/use-iconify-search\";\nimport { getIconUrl } from \"@/lib/iconify\";\nimport type { IconifySearchResponse } from \"@/lib/iconify\";\n\nconst DEFAULT_DEBOUNCE_MS = 300;\n\nexport interface IconifySearchState {\n  /** Whether multiple selection is allowed */\n  multiple: boolean;\n  /** Current raw query string */\n  query: string;\n  /** Update the search query */\n  setQuery: (value: string) => void;\n  /** Debounced query used for API calls */\n  debouncedQuery: string;\n  /** Whether the debouncer is still pending */\n  isDebouncing: boolean;\n  /** Raw search response from Iconify API */\n  data: IconifySearchResponse | undefined;\n  /** Whether the initial fetch is loading */\n  isLoading: boolean;\n  /** Whether a fetch is in progress (including refetch) */\n  isFetching: boolean;\n  /** Combined: debouncing or fetching */\n  isPending: boolean;\n  /** Helper to get Iconify CDN URL for an icon */\n  getIconUrl: (iconId: string, size?: number) => string;\n  /** Selected icon IDs (always an array; max 1 when multiple=false) */\n  selectedIcons: string[];\n  /** Update selected icons (enforces max 1 when multiple=false) */\n  setSelectedIcons: (iconIds: string[]) => void;\n  /** Select/replace icon when multiple=false; toggle when multiple=true */\n  selectIcon: (iconId: string) => void;\n  /** Icons grouped by collection prefix for display */\n  groups: Array<{ prefix: string; name: string; icons: string[] }>;\n}\n\nexport interface IconifySearchPrimitiveProps {\n  /** Allow selecting multiple icons. When false, max 1 and selectIcon replaces. */\n  multiple?: boolean;\n  /** Debounce delay in ms before triggering search */\n  debounceMs?: number;\n  /** Render function receiving search state */\n  children: (state: IconifySearchState) => React.ReactNode;\n}\n\n/**\n * Renderless component that interfaces with the Iconify API for icon search.\n * Always uses selectedIcons internally; when multiple=false, enforces max 1.\n * Use this to build custom UI (dialogs, etc.) without duplicating logic.\n */\nexport function IconifySearchPrimitive({\n  multiple = false,\n  debounceMs = DEFAULT_DEBOUNCE_MS,\n  children,\n}: IconifySearchPrimitiveProps): React.ReactElement {\n  const [query, setQuery] = React.useState(\"\");\n  const [selectedIcons, setSelectedIconsState] = React.useState<string[]>([]);\n\n  const setSelectedIcons = React.useCallback(\n    (ids: string[]) => {\n      setSelectedIconsState(multiple ? ids : ids.slice(0, 1));\n    },\n    [multiple]\n  );\n\n  const selectIcon = React.useCallback(\n    (iconId: string) => {\n      if (multiple) {\n        setSelectedIconsState((prev) =>\n          prev.includes(iconId)\n            ? prev.filter((id) => id !== iconId)\n            : [...prev, iconId]\n        );\n      } else {\n        setSelectedIconsState([iconId]);\n      }\n    },\n    [multiple]\n  );\n\n  const [debouncedQuery, debouncer] = useDebouncedValue(\n    query,\n    { wait: debounceMs },\n    (s) => ({ isPending: s.isPending })\n  );\n  const isDebouncing = debouncer.state.isPending ?? false;\n  const { data, isLoading, isFetching } = useIconifySearchAll(debouncedQuery);\n  const isPending = isDebouncing || isLoading || isFetching;\n\n  const groups = React.useMemo(() => {\n    const icons = data?.icons ?? [];\n    const deduped = [...new Set(icons)];\n    const allCollections: Record<string, { name: string }> = {};\n    if (data?.collections) {\n      Object.entries(data.collections).forEach(([prefix, info]) => {\n        allCollections[prefix] = { name: info.name ?? prefix };\n      });\n    }\n    for (const iconId of selectedIcons) {\n      if (!deduped.includes(iconId)) {\n        deduped.unshift(iconId);\n        const [prefix] = iconId.split(\":\");\n        if (prefix && !allCollections[prefix]) {\n          allCollections[prefix] = { name: prefix };\n        }\n      }\n    }\n    const byPrefix = new Map<string, string[]>();\n    for (const iconId of deduped) {\n      const prefix = iconId.split(\":\")[0] ?? \"other\";\n      if (!byPrefix.has(prefix)) byPrefix.set(prefix, []);\n      byPrefix.get(prefix)!.push(iconId);\n    }\n    return Array.from(byPrefix.entries()).map(([prefix, icons]) => ({\n      prefix,\n      name: allCollections[prefix]?.name ?? prefix,\n      icons,\n    }));\n  }, [data, selectedIcons]);\n\n  const state: IconifySearchState = {\n    multiple,\n    query,\n    setQuery,\n    debouncedQuery,\n    isDebouncing,\n    data,\n    isLoading,\n    isFetching,\n    isPending,\n    getIconUrl,\n    selectedIcons,\n    setSelectedIcons,\n    selectIcon,\n    groups,\n  };\n\n  return <>{children(state)}</>;\n}\n",
      "type": "registry:component"
    },
    {
      "path": "lib/iconify.ts",
      "content": "import type { IconifyInfo } from \"@iconify/types\";\n\nconst ICONIFY_API = \"https://api.iconify.design\";\n\nexport interface IconifySearchResponse {\n  icons: string[];\n  total: number;\n  limit: number;\n  start: number;\n  collections: Record<string, IconifyInfo>;\n  request: Record<string, string>;\n}\n\nexport async function searchIcons(\n  query: string,\n  options?: { limit?: number; start?: number }\n): Promise<IconifySearchResponse> {\n  const params = new URLSearchParams({\n    query: query.trim() || \" \",\n    limit: String(options?.limit ?? 64),\n    ...(options?.start != null && { start: String(options.start) }),\n  });\n\n  const response = await fetch(`${ICONIFY_API}/search?${params}`);\n\n  if (!response.ok) {\n    throw new Error(`Iconify API error: ${response.status}`);\n  }\n\n  return response.json();\n}\n\nexport function getIconUrl(iconId: string, size = 24): string {\n  const [prefix, name] = iconId.split(\":\");\n  if (!prefix || !name) return \"\";\n  return `https://api.iconify.design/${prefix}/${name}.svg?height=${size}`;\n}\n",
      "type": "registry:lib"
    },
    {
      "path": "hooks/use-iconify-search.ts",
      "content": "\"use client\"\n\nimport { useQuery } from \"@tanstack/react-query\"\nimport {\n  searchIcons,\n  type IconifySearchResponse,\n} from \"@/lib/iconify\"\n\nconst MAX_LIMIT = 999\n\nexport function useIconifySearchAll(query: string) {\n  return useQuery<IconifySearchResponse>({\n    queryKey: [\"iconify-search-all\", query],\n    queryFn: () => searchIcons(query, { limit: MAX_LIMIT }),\n    enabled: query.trim().length > 0,\n    staleTime: 1000 * 60 * 5,\n  })\n}\n",
      "type": "registry:hook"
    }
  ],
  "type": "registry:component"
}